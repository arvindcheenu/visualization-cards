<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="icon.png" type="image/png">
    <title>ViBBS â€“ Visualization Building Blocks and Scenarios</title>
    <meta name="description" content="Explore and organize different visualization techniques and design patterns with interactive cards">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/photoswipe@5/dist/photoswipe.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.8.1/vanilla-tilt.min.js"></script>
    <style>
        .scenarios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 1rem;
            padding: 1rem;
            padding-bottom: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            margin-bottom: 3.5rem;
            width: 100%;
        }
        .scenario-card {
            width: 100%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            overflow: hidden;
            cursor: pointer;
            border-radius: 6px;
            border: 5px solid rgb(28, 28, 28);
            transition: all 0.2s ease;
        }
        .scenario-card:hover {
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-color: rgb(0, 139, 154);
            filter: hue-rotate(-10deg) brightness(1.05) contrast(1.05);
        }
        .scenario-card img {
            width: 100%;
            height: auto;
            display: block;
        }
        .pswp {
            z-index: 9999;
        }
        /* Tilt.js styles for enhanced effects */
        .js-tilt-glare-inner {
            background: linear-gradient(0deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 100%);
        }
        /* Ensure smooth tilt by preventing conflicting transitions on card containers */
        [id^="card-"] {
            transform-style: preserve-3d;
        }
        [id^="card-"]:hover {
            filter: brightness(1.01) contrast(1.05) saturate(1.05);
            transition: none; /* Let vanilla-tilt handle all transforms */
        }
    </style>
</head>
<body class="font-sans bg-white text-black overflow-hidden transition-colors duration-300">
    <!-- Header -->
    <div class="text-center border-b border-gray-300 shadow-sm">
        <div class="flex items-center justify-between pl-4 pr-4 py-3 bg-gray-50">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold">
                    <img src="icon.png" alt="ViBBS Logo" class="w-10 h-10">
                </div>
                <div class="flex flex-col text-left gap-0">
                    <h1 class="text-xl font-semibold">ViBBS</h1>
                    <h4 class="text-sm text-gray-600">Visualization Building Blocks and Scenarios</h4>
                </div>
            </div>
            <div class="flex gap-2 md:w-auto items-center justify-end">
                <div class="hidden md:flex justify-center bg-gray-50">
                    <div class="bg-gray-200 p-1 mr-1 rounded-lg flex">
                        <button class="flex flex-row gap-2 px-4 py-1 rounded-md text-sm font-medium transition-all duration-200 bg-white text-blue-600 shadow-sm"
                                id="cardsTabButton"
                                onclick="switchToCards()">
                            <svg class="size-[18px] fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--!Font Awesome Pro 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2025 Fonticons, Inc.--><path d="M51.8 160.4c-3.7 2.1-4.9 6.8-2.8 10.5l167 289.3c2.1 3.7 6.8 4.9 10.5 2.8L419.4 351.6c3.7-2.1 4.9-6.8 2.8-10.5L255.2 51.8c-2.1-3.7-6.8-4.9-10.5-2.8L51.8 160.4zM7.5 194.9c-15.4-26.6-6.3-60.7 20.4-76.1L220.7 7.5c26.6-15.4 60.7-6.3 76.1 20.4l167 289.3c15.4 26.6 6.2 60.7-20.4 76.1L250.5 504.5c-26.6 15.4-60.7 6.2-76.1-20.4L7.5 194.9zm451.9 226c41.9-24.2 56.3-77.8 32.1-119.8L354.7 64.2c1.7-.2 3.5-.2 5.3-.2l224 0c30.9 0 56 25.1 56 56l0 336c0 30.9-25.1 56-56 56l-224 0c-13.7 0-26.2-4.9-35.9-13l135.3-78.1z"/></svg>Cards
                        </button>
                        <button class="flex flex-row gap-2 px-4 py-1 rounded-md text-sm font-medium transition-all duration-200 bg-gray-200 text-gray-600 hover:text-gray-800"
                                id="scenariosTabButton"
                                onclick="switchToScenarios()">
                                <svg class="size-[18px] fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Pro 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2025 Fonticons, Inc.--><path d="M374.8 80.3C355.9 33.2 309.8 0 256 0s-99.9 33.2-118.8 80.3c-3-.2-6.1-.3-9.2-.3C57.3 80 0 137.3 0 208s57.3 128 128 128c14.4 0 28.3-2.4 41.3-6.8C184.7 361.6 217.7 384 256 384s71.3-22.4 86.7-54.8c12.9 4.4 26.8 6.8 41.3 6.8c70.7 0 128-57.3 128-128s-57.3-128-128-128c-3.1 0-6.1 .1-9.2 .3zM144 480a48 48 0 1 0 0-96 48 48 0 1 0 0 96zM32 512a32 32 0 1 0 0-64 32 32 0 1 0 0 64z"/></svg>Scenarios
                        </button>
                    </div>
                </div>
                <!-- Loading indicator -->
                <div id="loadingIndicator" class="bg-gray-100 text-gray-700 w-8 h-8 rounded-full flex items-center justify-center transition-colors duration-200">
                    <i class="fas fa-spinner fa-spin text-sm"></i>
                </div>
                <button class="bg-gray-200 hover:bg-gray-200 text-gray-700 w-8 h-8 rounded-full flex items-center justify-center transition-colors duration-200" 
                        onclick="openInfoModal()">
                    <i class="fas fa-info text-sm"></i>
                </button>
            </div>
        </div>
    </div>
    <!-- Main Container -->
    <div id="mainContainer">
        <!-- Cards View -->
        <div class="h-screen flex flex-col" style="height: calc(100vh - 120px)" id="cardsView">
            <div class="flex-1 overflow-y-scroll mt-16 md:mt-0">
                <div class="h-full flex flex-row" id="cardsContent">
                    <!-- Loading message for cards -->
                    <div class="flex-1 flex items-center justify-center text-gray-500" id="loadingMessage">
                        <div class="text-center">
                            <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                            <p>Discovering cards...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Scenarios View -->
        <div class="hidden h-screen flex flex-col bg-slate-100" id="scenariosView">
            <div class="flex-1 overflow-y-auto mt-16 md:mt-0">
                <div class="scenarios-grid" id="scenariosGallery">
                    <div class="col-span-full flex items-center justify-center text-gray-500 py-8">
                        <div class="text-center">
                            <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                            <p>Loading scenarios...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Pinned Cards Drawer -->
    <div class="fixed bottom-3 left-0 right-0 bg-white border-t border-gray-300 z-50 transform transition-transform duration-300" 
         id="drawer" style="transform: translateY(calc(100% - 48px)); box-shadow: 0 -4px 6px -1px rgba(0,0,0,0.1);">
        <div class="flex justify-between items-center border-b border-gray-300 bg-gray-50 cursor-pointer" 
             onclick="toggleDrawer()">
            <h2 class="font-semibold p-4">
                Pinned Cards
                <span class="ml-2 bg-gray-600 text-white px-3 py-1 text-xs rounded-full" id="pinnedCount">0</span>
            </h2>
            <button class="text-lg p-4 rounded-lg hover:bg-gray-100">
                <i class="fas fa-chevron-up"></i>
            </button>
        </div>
        <div class="h-[520px] flex flex-col">
            <div class="flex gap-2 flex-nowrap p-4 w-full overflow-x-scroll overflow-y-hidden" id="filterPills">
                <!-- Filter pills will be generated by JavaScript -->
            </div>
            <div class="flex-1 overflow-hidden">
                <div class="flex gap-4 h-full overflow-x-auto" id="pinnedCards">
                    <div class="flex items-center justify-center h-48 text-gray-500 text-center min-w-full">
                        No cards pinned yet. Click on a card or use the pin button to save cards to your collection.
                    </div>
                </div>
            </div>
            <span class="text-gray-500 text-sm pl-4 pt-3 block">
                <i class="fas fa-info-circle text-xs mr-1"></i>
                To remove a pinned card from your collection, just click on the card.
            </span>
        </div>
    </div>
    <!-- Info Modal -->
    <div class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center transition-all hidden" id="infoModal" onclick="closeInfoModal()">
        <div class="bg-white rounded-lg max-w-2xl max-h-[80vh] m-4 shadow-xl flex flex-col" onclick="event.stopPropagation()">
            <!-- Fixed Header -->
            <div class="flex justify-between items-center border-b shadow-sm p-6 py-4 bg-gray-50 rounded-t-lg flex-shrink-0">
                <div class="flex flex-col items-left gap-0">
                    <h2 class="text-xl font-semibold">About ViBBS</h2>
                    <span class="text-sm text-gray-500">Visualization Building Blocks and Scenarios</span>
                </div>
                <button class="text-gray-500 hover:text-gray-700 w-8 h-8 rounded-full hover:bg-gray-100 flex items-center justify-center transition-colors duration-200" 
                        onclick="closeInfoModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <!-- Scrollable Content -->
            <div class="flex-1 overflow-y-auto min-h-0">
                <div class="p-6 space-y-4">
                    <p class="text-gray-700 leading-relaxed">
                        The <b>ViBBS â€“ Visualization Building Blocks and Scenarios</b> tool helps you explore and organize different visualization techniques and design patterns. 
                        Each card represents a specific approach or method that can be applied to data visualization projects.
                    </p>
                    <p class="text-sm text-gray-700 leading-relaxed">
                        Cards courtesy of <a href="https://www.igd.fraunhofer.de/de/institut/mitarbeitende/thorsten-may.html" class="text-blue-600 dark:text-blue-600 hover:underline" target="_blank">Thorsten May</a> from Fraunhofer IGD, <a href="https://lcibulski.github.io/" class="text-blue-600 dark:text-blue-600 hover:underline" target="_blank">Lena Cibulski</a> from the University of Rostock, <a href="https://www.au.dk/en/petermus@au.dk" class="text-blue-600 dark:text-blue-600 hover:underline" target="_blank">Peter Musaeus</a> and <a href="https://cs.au.dk/~hjschulz/" class="text-blue-600 dark:text-blue-600 hover:underline" target="_blank">Hans-JÃ¶rg Schulz</a> from Aarhus University. Developed by <a href="https://arvindchee.nu/" class="text-blue-600 dark:text-blue-600 hover:underline" target="_blank">Arvind Srinivasan</a> as a personal project to make these digital.
                    </p>
                    <div class="space-y-3">
                        <h3 class="font-semibold text-lg">Card Categories</h3>
                        <div class="space-y-3" id="categoryDescriptions">
                            <!-- Categories will be populated by JavaScript -->
                        </div>
                    </div>
                    <div class="space-y-3">
                        <h3 class="font-semibold text-lg">How to Use</h3>
                        <ul class="space-y-2 text-sm text-gray-700">
                            <li class="flex items-start gap-2">
                                <i class="fas fa-thumbtack text-xs mt-1 text-gray-500"></i>
                                <span><strong>Pin cards</strong> by clicking on them or using the pin button to save them to your collection</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-eye-slash text-xs mt-1 text-gray-500"></i>
                                <span><strong>Hide pinned cards</strong> in each category to focus on unpinned options</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-filter text-xs mt-1 text-gray-500"></i>
                                <span><strong>Filter pinned cards</strong> by category in the bottom drawer</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-chevron-up text-xs mt-1 text-gray-500"></i>
                                <span><strong>Open the drawer</strong> at the bottom to view and manage your pinned cards</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-images text-xs mt-1 text-gray-500"></i>
                                <span><strong>Switch to Scenarios</strong> to view scenario gallery with PhotoSwipe lightbox</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Mobile Top Segmented Control -->
    <div class="md:hidden fixed shadow-md top-[70px] w-full pl-4 pr-2 flex justify-center bg-gray-50">
        <div class="bg-gray-200 p-1 mr-1 rounded-lg flex mb-3 flex-1">
            <button class="flex-1 gap-2 px-4 py-1 rounded-md text-sm font-medium transition-all duration-200 bg-white text-blue-600 shadow-sm"
                    id="cardsTabButtonMobile"
                    onclick="switchToCards()">
                <div class="flex flex-col items-center"><svg class="size-[18px] fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--!Font Awesome Pro 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2025 Fonticons, Inc.--><path d="M51.8 160.4c-3.7 2.1-4.9 6.8-2.8 10.5l167 289.3c2.1 3.7 6.8 4.9 10.5 2.8L419.4 351.6c3.7-2.1 4.9-6.8 2.8-10.5L255.2 51.8c-2.1-3.7-6.8-4.9-10.5-2.8L51.8 160.4zM7.5 194.9c-15.4-26.6-6.3-60.7 20.4-76.1L220.7 7.5c26.6-15.4 60.7-6.3 76.1 20.4l167 289.3c15.4 26.6 6.2 60.7-20.4 76.1L250.5 504.5c-26.6 15.4-60.7 6.2-76.1-20.4L7.5 194.9zm451.9 226c41.9-24.2 56.3-77.8 32.1-119.8L354.7 64.2c1.7-.2 3.5-.2 5.3-.2l224 0c30.9 0 56 25.1 56 56l0 336c0 30.9-25.1 56-56 56l-224 0c-13.7 0-26.2-4.9-35.9-13l135.3-78.1z"/></svg>Cards</div>
            </button>
            <button class="flex-1 gap-2 px-4 py-1 rounded-md text-sm font-medium transition-all duration-200 bg-gray-200 text-gray-600 hover:text-gray-800" 
                    id="scenariosTabButtonMobile"
                    onclick="switchToScenarios()">
                    <div class="flex flex-col items-center"><svg class="size-[18px] fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Pro 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2025 Fonticons, Inc.--><path d="M374.8 80.3C355.9 33.2 309.8 0 256 0s-99.9 33.2-118.8 80.3c-3-.2-6.1-.3-9.2-.3C57.3 80 0 137.3 0 208s57.3 128 128 128c14.4 0 28.3-2.4 41.3-6.8C184.7 361.6 217.7 384 256 384s71.3-22.4 86.7-54.8c12.9 4.4 26.8 6.8 41.3 6.8c70.7 0 128-57.3 128-128s-57.3-128-128-128c-3.1 0-6.1 .1-9.2 .3zM144 480a48 48 0 1 0 0-96 48 48 0 1 0 0 96zM32 512a32 32 0 1 0 0-64 32 32 0 1 0 0 64z"/></svg>Scenarios</div>
            </button>
        </div>
    </div>
    <!-- PhotoSwipe Root -->
    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="pswp__bg"></div>
        <div class="pswp__scroll-wrap">
            <div class="pswp__container">
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
            </div>
            <div class="pswp__ui pswp__ui--hidden">
                <div class="pswp__top-bar">
                    <div class="pswp__counter"></div>
                    <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                    <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                    <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                    <div class="pswp__preloader">
                        <div class="pswp__preloader__icn">
                            <div class="pswp__preloader__cut">
                                <div class="pswp__preloader__donut"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="pswp__caption">
                    <div class="pswp__caption__center"></div>
                </div>
            </div>
        </div>
    </div>
    <script type="module">
        // Import PhotoSwipe
        import PhotoSwipeLightbox from 'https://unpkg.com/photoswipe@5/dist/photoswipe-lightbox.esm.js';
        
        // Import configurations
        import { decks as deckConfig } from './deck.js';
        
        // Global variables
        let currentView = 'cards'; // 'cards' or 'scenarios'
        let lightbox;
        let cardData = {};
        let decks = [];
        let deckConfigFromFile = {}; 
        let pinnedCards = [];
        let hidePinnedStates = [];
        let activeFilter = 'all';
        let isDesktop = false;
        
        // Check if device is desktop (not mobile/tablet)
        function checkIfDesktop() {
            isDesktop = window.innerWidth >= 1024 && !('ontouchstart' in window || navigator.maxTouchPoints > 0);
        }
        
        // Initialize tilt effect for cards (desktop only)
        function initTiltForCards(selector = '[id^="card-"]') {
            if (!isDesktop) return;
            // Wait a bit for DOM updates
            setTimeout(() => {
                const cards = document.querySelectorAll(selector);
                cards.forEach(card => {
                    // Skip if already initialized
                    if (card.vanillaTilt) return;
                    VanillaTilt.init(card, {
                        max: 8,              // Maximum tilt (degrees)
                        speed: 1000,         // Speed of tilt animation (higher = slower)
                        glare: true,         // Enable glare effect
                        "max-glare": 0.5,   // Maximum glare opacity
                        perspective: 1000,   // Transform perspective
                        scale: 1.02,         // Scale on hover
                        transition: false,   // Disable CSS transitions for smoother movement
                        reset: true,         // Reset tilt on mouse leave
                        "reset-to-start": false,
                        gyroscope: false,    // Disable gyroscope
                        "mouse-event-element": null,
                        "reset-transition": true
                    });
                });
            }, 100);
        }
        
        // Initialize tilt for pinned cards in drawer
        function initTiltForPinnedCards() {
            if (!isDesktop) return;
            setTimeout(() => {
                const pinnedCards = document.querySelectorAll('#pinnedCards > div[onclick]');
                pinnedCards.forEach(card => {
                    if (card.vanillaTilt) return;
                    VanillaTilt.init(card, {
                        max: 6,              // Slightly less tilt for pinned cards
                        speed: 1200,         // Slightly slower for pinned cards
                        glare: true,
                        "max-glare": 0.2,    // Less glare for pinned cards
                        perspective: 800,
                        scale: 1.01,         // Subtle scale
                        transition: false,   // Disable CSS transitions for smoother movement
                        reset: true,
                        "reset-to-start": false,
                        gyroscope: false,
                        "mouse-event-element": null,
                        "reset-transition": true
                    });
                });
            }, 150);
        }
        
        // Destroy tilt instances for cards that are being updated
        function destroyTiltForCards(selector) {
            const cards = document.querySelectorAll(selector);
            cards.forEach(card => {
                if (card.vanillaTilt) {
                    card.vanillaTilt.destroy();
                }
            });
        }
        
        function makeColorScheme(color) {
            let colorScheme = {}
            colorScheme.color = color;
            colorScheme.borderColor = `border-${color}-800`;
            colorScheme.bgColor = `bg-${color}-100`;
            colorScheme.headerBgColor = `bg-${color}-800 text-white`;
            colorScheme.activePillColor = `bg-${color}-600`;
            colorScheme.activePillHover = `hover:bg-${color}-700`;
            return colorScheme;
        }
        
        const defaultColorSchemes = ['red', 'orange', 'amber', 'yellow', 'lime', 'green', 'emerald', 'teal', 'cyan', 'sky', 'blue', 'indigo', 'violet', 'purple', 'fuchsia', 'pink', 'rose', 'slate', 'gray', 'zinc', 'neutral', 'stone'].map(color => makeColorScheme(color));
        
        // Switch to Cards view
        window.switchToCards = function() {
            currentView = 'cards';
            updateTabState();
            showCardsView();
        }
        
        // Switch to Scenarios view
        window.switchToScenarios = function() {
            currentView = 'scenarios';
            updateTabState();
            showScenariosView();
        }
        
        // Update tab state
        function updateTabState() {
            const cardsTabButton = document.getElementById('cardsTabButton');
            const scenariosTabButton = document.getElementById('scenariosTabButton');
            const cardsTabButtonMobile = document.getElementById('cardsTabButtonMobile');
            const scenariosTabButtonMobile = document.getElementById('scenariosTabButtonMobile');
            
            if (currentView === 'cards') {
                // Desktop tabs
                cardsTabButton.className = 'flex flex-row gap-2 px-4 py-1 rounded-md text-sm font-medium transition-all duration-200 bg-white text-blue-600 shadow-sm';
                scenariosTabButton.className = 'flex flex-row gap-2 px-4 py-1 rounded-md text-sm font-medium transition-all duration-200 bg-gray-200 text-gray-600 hover:text-gray-800';
                // Mobile tabs
                cardsTabButtonMobile.className = 'flex-1 gap-2 px-4 py-1 rounded-md text-sm font-medium transition-all duration-200 bg-white text-blue-600 shadow-sm';
                scenariosTabButtonMobile.className = 'flex-1 gap-2 px-4 py-1 rounded-md text-sm font-medium transition-all duration-200 bg-gray-200 text-gray-600 hover:text-gray-800';
            } else {
                // Desktop tabs
                cardsTabButton.className = 'flex flex-row gap-2 px-4 py-1 rounded-md text-sm font-medium transition-all duration-200 bg-gray-200 text-gray-600 hover:text-gray-800';
                scenariosTabButton.className = 'flex flex-row gap-2 px-4 py-1 rounded-md text-sm font-medium transition-all duration-200 bg-white text-teal-600 shadow-sm';
                // Mobile tabs
                cardsTabButtonMobile.className = 'flex-1 gap-2 px-4 py-1 rounded-md text-sm font-medium transition-all duration-200 bg-gray-200 text-gray-600 hover:text-gray-800';
                scenariosTabButtonMobile.className = 'flex-1 gap-2 px-4 py-1 rounded-md text-sm font-medium transition-all duration-200 bg-white text-teal-600 shadow-sm';
            }
        }
        
        // Show Cards view
        function showCardsView() {
            document.getElementById('cardsView').classList.remove('hidden');
            document.getElementById('scenariosView').classList.add('hidden');
            document.getElementById('drawer').style.display = 'block';
            // Reinitialize tilt effects for cards that might have been rendered
            initTiltForCards();
        }
        
        // Show Scenarios view
        function showScenariosView() {
            document.getElementById('cardsView').classList.add('hidden');
            document.getElementById('scenariosView').classList.remove('hidden');
            document.getElementById('drawer').style.display = 'none';
            // Load scenarios if not already loaded
            if (!document.querySelector('.scenario-card')) {
                loadScenarios();
            }
        }
        
        // Initialize PhotoSwipe
        function initPhotoSwipe() {
            if (lightbox) {
                lightbox.destroy();
            }
            lightbox = new PhotoSwipeLightbox({
                gallery: '#scenariosGallery',
                children: 'a',
                pswpModule: () => import('https://unpkg.com/photoswipe@5/dist/photoswipe.esm.js'),
            });
            lightbox.init();
        }
        
        // Load scenarios from scenarios/index.js
        async function loadScenarios() {
            const grid = document.getElementById('scenariosGallery');
            grid.innerHTML = `
                <div class="col-span-full flex items-center justify-center text-gray-500">
                    <div class="text-center">
                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                        <p>Loading scenarios...</p>
                    </div>
                </div>
            `;
            
            try {
                // Import scenarios from scenarios/index.js
                const { files } = await import('./scenarios/index.js');
                
                if (!files || files.length === 0) {
                    grid.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">No scenario images found. Run the generation script to populate scenarios/index.js.</div>';
                    return;
                }
                
                const imagePromises = files.map((filename, index) => {
                    return new Promise((resolve, reject) => {
                        const img = new Image();
                        img.onload = function() {
                            const scenarioCard = document.createElement('a');
                            scenarioCard.href = `scenarios/${filename}`;
                            scenarioCard.className = 'scenario-card';
                            scenarioCard.setAttribute('data-pswp-width', this.naturalWidth);
                            scenarioCard.setAttribute('data-pswp-height', this.naturalHeight);
                            scenarioCard.setAttribute('target', '_blank');
                            scenarioCard.setAttribute('data-scenario-index', index);
                            scenarioCard.innerHTML = `<img src="scenarios/${filename}" alt="Scenario ${filename}" loading="lazy">`;
                            resolve({ element: scenarioCard, index });
                        };
                        img.onerror = function() {
                            console.error(`Failed to load image: ${filename}`);
                            reject(new Error(`Failed to load image: ${filename}`));
                        };
                        img.src = `scenarios/${filename}`;
                    });
                });
                
                const results = await Promise.allSettled(imagePromises);
                const successfulResults = results
                    .filter(result => result.status === 'fulfilled')
                    .map(result => result.value)
                    .sort((a, b) => a.index - b.index);
                
                if (successfulResults.length === 0) {
                    grid.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">Failed to load any scenario images.</div>';
                    return;
                }
                
                grid.innerHTML = '';
                successfulResults.forEach(({ element }) => {
                    grid.appendChild(element);
                });
                
                attachHoverEffectToScenarioCards();
                initPhotoSwipe();
                
            } catch (error) {
                console.error('Error loading scenarios:', error);
                grid.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">Error loading scenarios. Make sure scenarios/index.js exists and is properly formatted.</div>';
            }
        }
        
        // === CARDS FUNCTIONALITY ===
        
        // Load deck configuration
        function loadDeckConfig() {
            try {
                if (deckConfig && Array.isArray(deckConfig)) {
                    deckConfigFromFile = {};
                    deckConfig.forEach(deck => {
                        deckConfigFromFile[deck.id] = deck;
                    });
                    return true;
                }
            } catch (error) {
                console.error('Could not load deck configuration:', error);
            }
            return false;
        }
        
        // Get color scheme for a color name
        function getColorScheme(colorName) {
            const colorSchemes = defaultColorSchemes.reduce((acc, color) => {
                acc[color.color] = color;
                return acc;
            }, {});
            return colorSchemes[colorName.toLowerCase()] || colorSchemes.blue;
        }
        
        // Hide loading indicator
        function hideLoadingIndicator() {
            const indicator = document.getElementById('loadingIndicator');
            if (indicator) {
                indicator.style.display = 'none';
            }
        }
        
        // Format deck name for display
        function formatDeckName(deckName) {
            return deckName.replace('/cards/','').split('-').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }
        
        // Parse filename to extract deck and card names
        function parseFilename(filename) {
            const nameWithoutExt = filename.replace(/\.[^/.]+$/, "");
            const underscoreIndex = nameWithoutExt.indexOf('_');
            if (underscoreIndex === -1) {
                return null;
            }
            const deckName = nameWithoutExt.substring(0, underscoreIndex);
            const cardName = nameWithoutExt.substring(underscoreIndex + 1);
            return { deckName, cardName };
        }
        
        // Load cards from cards/index.js
        async function loadCards() {
            try {
                // Import cards from cards/index.js
                const { files } = await import('./cards/index.js');
                
                if (!files || files.length === 0) {
                    showNoCardsMessage();
                    return;
                }
                
                cardData = {};
                files.forEach(filename => {
                    const parsed = parseFilename(filename);
                    if (parsed) {
                        if (!cardData[parsed.deckName]) {
                            cardData[parsed.deckName] = [];
                        }
                        cardData[parsed.deckName].push(parsed.cardName);
                    }
                });
                
                generateDeckConfigFromCardData();
                buildDecksFromCardData();
                
            } catch (error) {
                console.error('Error loading cards:', error);
                showErrorMessage('Error loading cards. Make sure cards/index.js exists and is properly formatted.');
            }
        }
        
        // Generate deck configuration from discovered card data
        function generateDeckConfigFromCardData() {
            deckConfigFromFile = deckConfigFromFile || {};
            const deckNames = Object.keys(cardData);
            deckNames.forEach((deckName, index) => {
                const configFromFile = deckConfigFromFile[deckName.replace('cards/', '').replace('/', '')];
                let colorScheme;
                let title;
                let description;
                
                if (configFromFile) {
                    colorScheme = getColorScheme(configFromFile.color);
                    title = configFromFile.title;
                    description = configFromFile.description;
                } else {
                    colorScheme = defaultColorSchemes[index % defaultColorSchemes.length];
                    title = formatDeckName(deckName);
                    description = `Cards in the ${title} category.`;
                }
                
                deckConfigFromFile[deckName] = {
                    title: title,
                    description: description,
                    order: configFromFile ? configFromFile.order : index + 1,
                    ...colorScheme
                };
            });
        }
        
        // Build decks structure from discovered card data
        function buildDecksFromCardData() {
            decks = [];
            hidePinnedStates = [];
            
            const deckEntries = Object.keys(cardData).map(deckKey => ({
                key: deckKey,
                config: deckConfigFromFile[deckKey],
                cards: cardData[deckKey]
            }));
            
            deckEntries.sort((a, b) => {
                const orderA = a.config.order || 999;
                const orderB = b.config.order || 999;
                return orderA - orderB;
            });
            
            deckEntries.forEach(entry => {
                if (entry.cards.length > 0) {
                    decks.push({
                        title: entry.config.title,
                        key: entry.key,
                        cards: entry.cards,
                        ...entry.config
                    });
                    hidePinnedStates.push(false);
                }
            });
            
            const loadingMessage = document.getElementById('loadingMessage');
            if (loadingMessage) {
                loadingMessage.style.display = 'none';
            }
            
            if (decks.length === 0) {
                showNoCardsMessage();
            } else {
                renderDecks();
                updatePinnedCount();
                updateFilterPills();
                updatePinnedCardsDisplay();
                updateInfoModalCategories();
                // Initialize tilt effects after rendering
                initTiltForCards();
            }
            hideLoadingIndicator();
        }
        
        // Update info modal with categories from configuration
        function updateInfoModalCategories() {
            const container = document.getElementById('categoryDescriptions');
            let categoriesHTML = '';
            
            decks.forEach(deck => {
                const colorClass = `bg-${deck.color}-600`;
                categoriesHTML += `
                    <div class="flex items-start gap-3">
                        <div class="w-4 h-4 ${colorClass} rounded-sm mt-1 flex-shrink-0"></div>
                        <div>
                            <h4 class="font-medium">${deck.title}</h4>
                            <p class="text-sm text-gray-600">${deck.description}</p>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = categoriesHTML;
        }
        
        // Show message when no cards are found
        function showNoCardsMessage() {
            const container = document.getElementById('cardsContent');
            container.innerHTML = `
                <div class="flex-1 flex items-center justify-center text-gray-500">
                    <div class="text-center max-w-md">
                        <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                        <p class="mb-4">No cards found.</p>
                        <div class="text-sm space-y-2">
                            <p>Make sure to:</p>
                            <div class="bg-gray-100 p-3 rounded text-left">
                                <p>1. Add card files using the pattern: <code>deck-name_card-name.png</code></p>
                                <p>2. Run the generation script to create <code>cards/index.js</code></p>
                            </div>
                            <div class="text-xs text-gray-400 mt-3">
                                Examples:<br>
                                <code>visualization_bar-chart.png</code><br>
                                <code>interaction_tooltip.png</code><br>
                                <code>mapping_color-scale.png</code>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Show error message
        function showErrorMessage(message) {
            const container = document.getElementById('cardsContent');
            container.innerHTML = `
                <div class="flex-1 flex items-center justify-center text-gray-500">
                    <div class="text-center max-w-md">
                        <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                        <p class="mb-4">${message}</p>
                    </div>
                </div>
            `;
            hideLoadingIndicator();
        }
        
        // Load data from localStorage
        function loadData() {
            const savedPinnedCards = localStorage.getItem('pinnedCards');
            const savedHidePinnedStates = localStorage.getItem('hidePinnedStates');
            const savedActiveFilter = localStorage.getItem('activeFilter');
            
            if (savedPinnedCards) {
                pinnedCards = JSON.parse(savedPinnedCards);
            }
            if (savedHidePinnedStates) {
                hidePinnedStates = JSON.parse(savedHidePinnedStates);
            }
            if (savedActiveFilter) {
                activeFilter = savedActiveFilter;
            }
        }
        
        // Save data to localStorage
        function saveData() {
            localStorage.setItem('pinnedCards', JSON.stringify(pinnedCards));
            localStorage.setItem('hidePinnedStates', JSON.stringify(hidePinnedStates));
            localStorage.setItem('activeFilter', activeFilter);
        }
        
        // Initialize the application
        async function init() {
            checkIfDesktop();
            loadData();
            loadDeckConfig();
            await loadCards();
            updateTabState();
        }
        
        // Render all decks
        function renderDecks() {
            const container = document.getElementById('cardsContent');
            container.innerHTML = '';
            
            decks.forEach((deck, deckIndex) => {
                const deckElement = createDeckElement(deck, deckIndex);
                container.appendChild(deckElement);
            });
        }
        
        // Create a deck element
        function createDeckElement(deck, deckIndex) {
            const deckDiv = document.createElement('div');
            deckDiv.className = `flex-1 flex flex-col min-h-0 ${deck.bgColor}`;
            deckDiv.id = `deck-${deckIndex}`;
            
            const visibleCardCount = getVisibleCardCount(deckIndex);
            
            deckDiv.innerHTML = `
                <div class="flex justify-between items-center border-b ${deck.headerBgColor} flex-shrink-0">
                    <h3 class="font-semibold p-4">
                        ${deck.title}
                        <span class="ml-2 ${deck.activePillColor} text-white px-3 py-1 text-xs rounded-full" id="count-${deckIndex}">${visibleCardCount}</span>
                    </h3>
                    <button class="text-sm flex bg-${deck.color}-600 border border-2 border-${deck.color}-900 hover:bg-${deck.color}-500  hover:scale-[102%] active:scale-[98%] active:bg-${deck.color}-700  items-center gap-2 mr-2 px-4 py-2 rounded-lg transition-all duration-200" 
                            id="hideButton-${deckIndex}"
                            onclick="toggleHidePinned(${deckIndex})">
                        <i class="fas ${hidePinnedStates[deckIndex] ? 'fa-eye' : 'fa-eye-slash'}" id="hideIcon-${deckIndex}"></i>
                        <span id="hideText-${deckIndex}">${hidePinnedStates[deckIndex] ? 'Show Pinned' : 'Hide Pinned'}</span>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto min-h-0">
                    <div class="flex flex-col gap-4 p-4 items-center" id="cardsContainer-${deckIndex}">
                        ${generateCards(deck, deckIndex)}
                    </div>
                </div>
            `;
            
            return deckDiv;
        }
        
        // Get count of visible cards in a deck
        function getVisibleCardCount(deckIndex) {
            let count = 0;
            for (let i = 0; i < decks[deckIndex].cards.length; i++) {
                const cardId = `${deckIndex}-${i}`;
                const isPinned = pinnedCards.some(card => card.id === cardId);
                const shouldHide = hidePinnedStates[deckIndex] && isPinned;
                if (!shouldHide) count++;
            }
            return count;
        }
        
        // Format card name for display
        function formatCardName(cardName) {
            return cardName.split('-').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }
        
        // Get border color for card image based on deck and pin status
        function getCardImageBorderColor(deckIndex, isPinned) {
            if (isPinned) {
                return 'border-black';
            }
            return decks[deckIndex].borderColor;
        }
        
        // Generate cards for a deck
        function generateCards(deck, deckIndex) {
            let cardsHTML = '';
            let hasVisibleCard = false;
            
            for (let i = 0; i < deck.cards.length; i++) {
                const cardId = `${deckIndex}-${i}`;
                const cardName = deck.cards[i];
                const imagePath = `cards/${deck.key}_${cardName}.png`;
                const displayName = formatCardName(cardName);
                const isPinned = pinnedCards.some(card => card.id === cardId);
                const shouldHide = hidePinnedStates[deckIndex] && isPinned;
                
                if (!shouldHide) {
                    hasVisibleCard = true;
                    const imageBorderColor = getCardImageBorderColor(deckIndex, isPinned);
                    const shadowClass = isPinned ? 'shadow-lg shadow-gray-400' : 'hover:shadow-md hover:shadow-gray-400';
                    const bgClass = isPinned ? 'bg-blue-50' : 'bg-white';
                    const deckColor = decks[deckIndex].color;
                    
                    cardsHTML += `
                        <div class="w-[300px] ${bgClass} ${shadowClass} rounded-lg transition-all duration-200 cursor-pointer" 
                             id="card-${cardId}"
                             onclick="togglePin('${cardId}', ${deckIndex}, ${i})">
                            <div class="w-full rounded-lg bg-gray-100 ${imageBorderColor} border-4 flex items-center justify-center text-gray-600 overflow-hidden relative">
                                <img src="${imagePath}" alt="${displayName}" 
                                     class="w-full h-full object-cover"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div class="w-full h-full flex items-center justify-center text-gray-400 text-sm" style="display: none;">
                                    ${displayName}
                                </div>
                                <button class="absolute top-3 right-3 w-8 h-8 rounded-full border border-2 border-${deckColor}-900 text-white text-sm flex items-center justify-center ${isPinned ? `bg-${deckColor}-600 hover:bg-${deckColor}-700` : `bg-white text-${deckColor}-700 hover:bg-${deckColor}-200`} z-10 transition-colors duration-200" 
                                        onclick="event.stopPropagation(); togglePin('${cardId}', ${deckIndex}, ${i})">
                                    <i class="fas fa-thumbtack"></i>
                                </button>
                            </div>
                        </div>
                    `;
                }
            }
            
            return hasVisibleCard ? cardsHTML : 
                '<div class="w-[300px] bg-white rounded-lg"><div class="w-full bg-gray-100 border border-gray-200 border-4 flex items-center justify-center text-gray-600 p-4 rounded-lg">All cards are pinned</div></div>';
        }
        
        // Toggle pin status of a card
        window.togglePin = function(cardId, deckIndex, cardIndex) {
            const existingIndex = pinnedCards.findIndex(card => card.id === cardId);
            
            if (existingIndex !== -1) {
                pinnedCards.splice(existingIndex, 1);
            } else {
                const deck = decks[deckIndex];
                const cardName = deck.cards[cardIndex];
                pinnedCards.push({
                    id: cardId,
                    deckIndex: deckIndex,
                    cardIndex: cardIndex,
                    title: deck.title,
                    cardName: cardName,
                    displayName: formatCardName(cardName),
                    imagePath: `cards/${deck.key}_${cardName}.png`,
                    cardNumber: cardIndex + 1,
                    totalCards: deck.cards.length
                });
            }
            
            updateSpecificCard(cardId, deckIndex, cardIndex);
            updateDeckCardCount(deckIndex);
            updateFilterPills();
            updatePinnedCardsDisplay();
            updatePinnedCount();
            saveData();
        }
        
        // Update only a specific card
        function updateSpecificCard(cardId, deckIndex, cardIndex) {
            const cardElement = document.getElementById(`card-${cardId}`);
            if (!cardElement) return;
            
            // Destroy existing tilt before updating
            if (cardElement.vanillaTilt) {
                cardElement.vanillaTilt.destroy();
            }
            
            const isPinned = pinnedCards.some(card => card.id === cardId);
            const button = cardElement.querySelector('button');
            const icon = button.querySelector('i');
            const imageContainer = cardElement.querySelector('div > div');
            const imageBorderColor = getCardImageBorderColor(deckIndex, isPinned);
            const deckColor = decks[deckIndex].color;
            
            if (isPinned) {
                cardElement.className = `w-[300px] bg-blue-50 shadow-lg shadow-gray-400 rounded-lg transition-all duration-200 cursor-pointer`;
                button.className = `absolute border border-2 border-${deckColor}-900 top-3 right-3 w-8 h-8 rounded-full text-white text-sm flex items-center justify-center bg-${deckColor}-600 hover:bg-${deckColor}-700 z-10 transition-colors duration-200`;
                icon.className = 'fas fa-thumbtack';
                imageContainer.className = `w-full rounded-lg bg-gray-100 ${imageBorderColor} border-4 flex items-center justify-center text-gray-600 overflow-hidden relative`;
            } else {
                cardElement.className = 'w-[300px] bg-white rounded-lg transition-all duration-200 cursor-pointer';
                button.className = `absolute border border-2 border-${deckColor}-900 top-3 right-3 w-8 h-8 rounded-full text-white text-sm flex items-center justify-center bg-white text-${deckColor}-700 hover:bg-${deckColor}-200 z-10 transition-colors duration-200`;
                icon.className = 'fas fa-thumbtack';
                imageContainer.className = `w-full rounded-lg bg-gray-100 ${imageBorderColor} border-4 flex items-center justify-center text-gray-600 overflow-hidden relative`;
            }
            
            if (hidePinnedStates[deckIndex] && isPinned) {
                cardElement.style.display = 'none';
            } else {
                cardElement.style.display = 'block';
            }
            
            // Reinitialize tilt for this specific card
            if (isDesktop && cardElement.style.display !== 'none') {
                setTimeout(() => {
                    VanillaTilt.init(cardElement, {
                        max: 8,
                        speed: 1000,
                        glare: true,
                        "max-glare": 0.3,
                        perspective: 1000,
                        scale: 1.02,
                        transition: false,
                        reset: true,
                        "reset-to-start": false,
                        gyroscope: false,
                        "mouse-event-element": null,
                        "reset-transition": true
                    });
                }, 50);
            }
        }
        
        // Update deck card count
        function updateDeckCardCount(deckIndex) {
            const countElement = document.getElementById(`count-${deckIndex}`);
            if (countElement) {
                countElement.textContent = getVisibleCardCount(deckIndex);
            }
        }
        
        // Toggle hide pinned state
        window.toggleHidePinned = function(deckIndex) {
            hidePinnedStates[deckIndex] = !hidePinnedStates[deckIndex];
            
            const icon = document.getElementById(`hideIcon-${deckIndex}`);
            const text = document.getElementById(`hideText-${deckIndex}`);
            
            if (icon && text) {
                icon.className = `fas ${hidePinnedStates[deckIndex] ? 'fa-eye' : 'fa-eye-slash'}`;
                text.textContent = hidePinnedStates[deckIndex] ? 'Show Pinned' : 'Hide Pinned';
            }
            
            for (let i = 0; i < decks[deckIndex].cards.length; i++) {
                const cardId = `${deckIndex}-${i}`;
                updateSpecificCard(cardId, deckIndex, i);
            }
            
            updateDeckCardCount(deckIndex);
            saveData();
        }
        
        // Update filter pills
        function updateFilterPills() {
            const container = document.getElementById('filterPills');
            const deckCounts = decks.map((deck, index) => {
                return pinnedCards.filter(card => card.deckIndex === index).length;
            });
            const totalCount = pinnedCards.length;
            
            let pillsHTML = `
                <button class="text-sm border border-gray-300 ${activeFilter === 'all' ? 'bg-blue-600 text-white hover:bg-blue-700' : 'bg-gray-50 hover:bg-gray-100'} px-2 pl-4 py-2 rounded-full transition-colors duration-200" 
                        onclick="setFilter('all')">
                    All<span class="ml-2 px-2 py-1 text-xs ${activeFilter === 'all' ? 'bg-blue-300 bg-opacity-30' : 'bg-black bg-opacity-20'} rounded-full">${totalCount}</span>
                </button>
            `;
            
            decks.forEach((deck, index) => {
                const colorClass = `bg-${deck.color}-300`;
                if (deckCounts[index] > 0) {
                    const isActive = activeFilter === index.toString();
                    const activeClasses = isActive ? `${deck.activePillColor} text-white ${deck.activePillHover}` : 'bg-gray-50 hover:bg-gray-100';
                    pillsHTML += `
                        <button class="text-sm border border-gray-300 ${activeClasses} px-2 pl-4 py-2 rounded-full transition-colors duration-200" 
                                onclick="setFilter('${index}')">
                            ${deck.title}<span class="ml-2 px-2 py-1 text-xs ${isActive ? `${colorClass} bg-opacity-30` : `bg-black bg-opacity-20`} rounded-full">${deckCounts[index]}</span>
                        </button>
                    `;
                }
            });
            
            container.innerHTML = pillsHTML;
        }
        
        // Set active filter
        window.setFilter = function(filter) {
            activeFilter = filter;
            updateFilterPills();
            updatePinnedCardsDisplay();
            saveData();
        }
        
        // Update pinned cards display
        function updatePinnedCardsDisplay() {
            const container = document.getElementById('pinnedCards');
            
            // Destroy existing tilt instances
            destroyTiltForCards('#pinnedCards > div[onclick]');
            
            if (pinnedCards.length === 0) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-48 text-gray-500 text-center min-w-full">
                        <i class="fas fa-thumbtack text-2xl mb-2"></i>
                        <h3 class="text-lg font-semibold text-gray-700">No cards pinned yet</h3>
                        <p class="text-sm text-gray-500">Pin some cards to see them here!</p>
                    </div>
                `;
                return;
            }
            
            const filteredCards = activeFilter === 'all' 
                ? pinnedCards 
                : pinnedCards.filter(card => card.deckIndex.toString() === activeFilter);
            
            if (filteredCards.length === 0) {
                container.innerHTML = '<div class="flex items-center justify-center h-48 text-gray-500 text-center min-w-full">No cards match the selected filter.</div>';
                return;
            }
            
            const cardsHTML = filteredCards.map(card => `
                <div class="first:ml-4 last:mr-4 mt-4 w-[250px] h-fit bg-blue-50 shadow-none cursor-not-allowed rounded-lg flex-shrink-0 transition-all duration-200 cursor-pointer"
                     onclick="togglePin('${card.id}', ${card.deckIndex}, ${card.cardIndex})">
                    <div class="w-full rounded-lg bg-gray-100 border-black border-4 flex items-center justify-center text-gray-600 overflow-hidden relative" >
                        <img src="${card.imagePath}" alt="${card.displayName}" 
                             class="w-full h-full object-cover"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="w-full h-full flex items-center justify-center text-gray-400 text-sm" style="display: none;">
                            ${card.displayName}
                        </div>
                        <button class="absolute top-[-6px] right-[-6px] w-8 h-8 rounded-md text-white bg-black hover:bg-gray-700 text-sm flex items-center justify-center z-10 transition-colors duration-200" 
                                onclick="event.stopPropagation(); togglePin('${card.id}', ${card.deckIndex}, ${card.cardIndex})">
                            <i class="fas fa-times mt-1 mr-1"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = cardsHTML;
            
            // Initialize tilt for newly created pinned cards
            initTiltForPinnedCards();
        }
        
        // Update pinned count
        function updatePinnedCount() {
            document.getElementById('pinnedCount').textContent = pinnedCards.length;
        }
        
        // Toggle drawer
        window.toggleDrawer = function() {
            const drawer = document.getElementById('drawer');
            const button = drawer.querySelector('button i');
            const isOpen = drawer.style.transform === 'translateY(0px)';
            
            drawer.style.transform = isOpen ? 'translateY(calc(100% - 48px))' : 'translateY(0px)';
            button.className = isOpen ? 'fas fa-chevron-up' : 'fas fa-chevron-down';
        }
        
        // Open info modal
        window.openInfoModal = function() {
            document.getElementById('infoModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        // Close info modal
        window.closeInfoModal = function() {
            document.getElementById('infoModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
        
        // Close modal on Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeInfoModal();
            }
        });
        
        // Handle window resize to recheck desktop status
        window.addEventListener('resize', function() {
            const wasDesktop = isDesktop;
            checkIfDesktop();
            // If status changed, reinitialize or destroy tilt effects
            if (wasDesktop !== isDesktop) {
                if (isDesktop) {
                    initTiltForCards();
                    initTiltForPinnedCards();
                } else {
                    // Destroy all tilt instances on mobile
                    destroyTiltForCards('[id^="card-"]');
                    destroyTiltForCards('#pinnedCards > div[onclick]');
                }
            }
        });
        
        function attachHoverEffectToScenarioCards() {
            document.querySelectorAll('.scenario-card').forEach(card => {
                card.addEventListener('mouseover', function() {
                    this.style.transform = `translateY(-2px) rotate(${Math.random() * 2 - 1}deg)`;
                });
                card.addEventListener('mouseout', function() {
                    this.style.transform = 'translateY(0) rotate(0deg)';
                });
            });
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>